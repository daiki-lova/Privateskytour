# PRIVATESKY TOUR 要件定義書

## 1. プロジェクト概要

### 1.1 サービス名
- **サービス名**: PRIVATESKY TOUR（プライベートスカイツアー）
- **サイト名**: ヘリフロント / SkyView

### 1.2 サービス概要
東京ヘリポートを拠点としたヘリコプター遊覧・送迎サービスの予約システム

### 1.3 技術スタック
| 項目 | 技術 |
|------|------|
| フレームワーク | Next.js 15 (App Router) |
| データベース・認証 | Supabase |
| 決済 | Stripe |
| メール送信 | Resend |
| ホスティング | Vercel |
| UI | shadcn/ui + Tailwind CSS |

### 1.4 対応言語
- **公開ページ**: 日本語、英語、中国語
- **管理画面**: 日本語のみ

---

## 2. ユーザー種別と認証

### 2.1 顧客（Customer）
- **ログイン**: 不要
- **アカウント作成**: 予約時に自動作成（メールアドレスベース）
- **マイページアクセス**: 予約完了メールのリンクから（トークン認証）
- **パスワードリセット**: 必要

### 2.2 管理者（Admin）
- **ログイン**: メールアドレス + パスワード
- **アカウント作成**: データベース直接登録
- **権限**: 現時点では単一権限（将来的にスタッフ・閲覧者を追加予定）
- **2段階認証**: 不要

---

## 3. 予約フロー

### 3.1 基本フロー
```
コース選択 → 日時選択 → 搭乗者情報入力 → 確認 → 決済 → 完了
```

### 3.2 スロット管理
- **営業時間**: 9:00〜19:00（管理画面で設定可能）
- **スロット間隔**: 30分
- **最大搭乗人数**: 3名/フライト
- **メンテナンス・休日設定**: 管理画面から設定可能

### 3.3 予約確定タイミング
- **決済完了時点で確定**（早い者勝ち）
- 競合時は決済完了した方が優先
- 負けた場合は別スロット選択へ誘導

---

## 4. 搭乗者情報

### 4.1 必須項目
| 項目 | 対象 | 備考 |
|------|------|------|
| 氏名 | 全員 | 漢字 + ローマ字 |
| 体重 | 全員 | 安全上必須（予約時に入力） |
| 電話番号 | 代表者のみ | |
| メールアドレス | 代表者のみ | |
| 搭乗理由 | 任意 | データ収集目的 |

### 4.2 子供・幼児
- **3歳以上**: 搭乗可能（1名としてカウント）
- **12歳未満**: 保護者同伴必須
- **2歳未満**: 膝上で無料（人数にカウントしない、チェックボックスで申告）

---

## 5. コース管理

### 5.1 コース種別
- **遊覧コース**: 東京上空を周遊
- **送迎コース**: 目的地への移動

### 5.2 管理機能
- 管理画面からコース情報を編集可能（ハードコードしない）
- 編集項目: 名称、説明、料金、所要時間、画像

---

## 6. アルファード送迎サービス

### 6.1 対象条件
- **30分以上のプラン**を予約した方
- **東京23区内**への送迎
- **希望者のみ**（無料）

### 6.2 運用
- 送迎時間は運営側が決定
- 予約時に希望の有無を確認

---

## 7. 決済

### 7.1 決済システム
- **Stripe**を使用
- **即時決済**（予約時に全額決済）

### 7.2 請求情報
- **請求名**: PRIVATESKY TOUR
- **インボイス制度対応**: 必須（株式会社のため）

### 7.3 領収書
- Stripeからの自動発行
- マイページからもダウンロード可能

---

## 8. キャンセルポリシー

### 8.1 キャンセル料
| 期間 | キャンセル料 |
|------|------------|
| 7日前まで | 無料 |
| 4日前まで | 30% |
| 2日前まで | 50% |
| 前日〜当日 | 100% |

### 8.2 キャンセル方式
- **7日前まで**: マイページからセルフキャンセル可能
- **6日前以降**: 管理者承認制（問い合わせ経由）

### 8.3 天候キャンセル
- 運営判断で中止の場合: **全額返金**
- 判断タイミング: 管理画面で設定可能

### 8.4 ポリシー管理
- 管理画面から編集可能
- 編集内容はフロントに自動反映

---

## 9. 通知システム

### 9.1 顧客向けメール

| タイミング | 内容 |
|-----------|------|
| 予約完了時 | 予約詳細、当日連絡先、集合場所、注意事項 |
| 3日前 | リマインダー（日時、場所、持ち物） |
| 前日 | 最終リマインダー（天候情報含む） |
| キャンセル時 | キャンセル確認、返金情報 |
| 搭乗翌日 | お礼メール、レビュー依頼リンク |

### 9.2 管理者向け通知
- 新規予約
- キャンセル申請
- 問い合わせ受信
- **通知先メールアドレス**: 複数設定可能

---

## 10. マイページ機能

### 10.1 機能一覧
- 予約一覧表示
- 予約詳細確認
- プロフィール編集
- 領収書ダウンロード
- セルフキャンセル（7日前まで）

### 10.2 アクセス方法
- 予約完了メールのリンクから（トークン認証）
- パスワードリセット機能あり

---

## 11. 管理画面機能

### 11.1 ダッシュボード
- 本日の予約一覧
- 今月の売上サマリー
- 直近の予約

### 11.2 予約管理
- 予約一覧・検索・フィルタ
- 予約詳細表示
- ステータス変更
- 手動キャンセル処理

### 11.3 スロット管理
- 営業時間設定
- メンテナンス・休日設定
- スロット単位の開閉

### 11.4 コース管理
- コース情報編集
- 料金変更
- 公開/非公開設定

### 11.5 ヘリポート管理
- ヘリポート情報編集

### 11.6 マニフェスト
- フライトごとの搭乗者リスト出力
- 当日運用資料

### 11.7 顧客管理
- 顧客一覧・検索
- 顧客詳細（予約履歴含む）

### 11.8 返金管理
- 返金申請一覧
- 返金処理

### 11.9 ログ
- 操作ログ
- システムログ

### 11.10 設定
- 営業時間設定
- キャンセルポリシー設定
- 天候判断タイミング設定
- 通知先メールアドレス設定
- 当日連絡先設定

---

## 12. 安全・運用要件

### 12.1 当日連絡先
- リマインダーメールに当日連絡先を記載
- 管理画面で番号を設定可能

### 12.2 遅刻ポリシー
- 出発時刻の一定時間前までに到着（時間は管理画面で設定）
- 遅刻による搭乗不可は「お客様都合のキャンセル」扱い

### 12.3 健康状態確認
予約時に以下のチェックボックスで確認：
- 妊娠中ではない、または医師の許可を得ている
- 心臓疾患等、搭乗に支障のある持病がない
- 飲酒状態での搭乗はできないことを理解している

### 12.4 本人確認書類
- 不要

### 12.5 同意書・免責事項
- 予約確定前に利用規約・免責事項への同意を必須化
- 利用規約は管理画面から編集可能

---

## 13. 問い合わせ

### 13.1 問い合わせフォーム
標準的なフォーム：
- 氏名
- メールアドレス
- 電話番号（任意）
- 件名
- 内容

### 13.2 通知
- 問い合わせ受信時に管理者へメール通知

---

## 14. SEO・アナリティクス

### 14.1 SEO/OGP
- OGP画像: コースの画像を使用
- コース編集時にOGP画像も自動更新

### 14.2 Google Analytics
- GA4を導入
- 予約完了のコンバージョントラッキング
- 一般的な分析指標

---

## 15. 初期リリースで実装しない機能

以下は将来対応として初期リリースでは実装しない：
- オプションサービス（花束、シャンパン、カメラマン等）
- 写真サービス
- スタッフ・閲覧者権限
- 法人・団体向け専用フロー
- ステージング環境
- ベーシック認証

---

## 16. 非機能要件

### 16.1 パフォーマンス
- ページ読み込み: 3秒以内
- 決済処理: 10秒以内

### 16.2 セキュリティ
- HTTPS必須
- Supabase RLSによるデータ保護
- Stripe PCI DSS準拠

### 16.3 可用性
- Vercelの標準SLA

---

## 変更履歴

| 日付 | 内容 |
|------|------|
| 2026-01-26 | 初版作成 |
